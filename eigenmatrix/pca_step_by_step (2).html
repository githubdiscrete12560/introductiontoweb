<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA Step-by-Step Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .step {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .step h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        .calculation {
            background-color: #f0f8ff;
            padding: 15px;
            border-left: 4px solid #007acc;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .plot-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        .matrix {
            font-family: monospace;
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: inline-block;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>Principal Component Analysis (PCA) - Step by Step</h1>
    <p><strong>Original Data Points:</strong> [(2.0, 2.0), (3.0, 4.0), (4.0, 5.0), (5.0, 7.0)]</p>

    <div class="step">
        <h2>Step 1: Original Data</h2>
        <p>Let's start by visualizing our original 2D data points:</p>
        <div id="plot1" class="plot-container"></div>
        <div class="calculation">Data Matrix X:
[2.0  2.0]
[3.0  4.0]
[4.0  5.0]
[5.0  7.0]

Each row represents a data point, each column represents a feature (dimension).
</div>
    </div>

    <div class="step">
        <h2>Step 2: Calculate the Mean</h2>
        <div class="calculation">Mean calculation:
μ₁ = (2.0 + 3.0 + 4.0 + 5.0) / 4 = 14.0 / 4 = 3.5
μ₂ = (2.0 + 4.0 + 5.0 + 7.0) / 4 = 18.0 / 4 = 4.5

Mean vector μ = [3.5, 4.5]
</div>
    </div>

    <div class="step">
        <h2>Step 3: Center the Data (Subtract Mean)</h2>
        <p>Subtract the mean from each data point to center the data around the origin:</p>
        <div class="calculation">Centered Data Matrix (X - μ):
Point 1: [2.0 - 3.5, 2.0 - 4.5] = [-1.5, -2.5]
Point 2: [3.0 - 3.5, 4.0 - 4.5] = [-0.5, -0.5]
Point 3: [4.0 - 3.5, 5.0 - 4.5] = [ 0.5,  0.5]
Point 4: [5.0 - 3.5, 7.0 - 4.5] = [ 1.5,  2.5]

Centered Matrix:
[-1.5  -2.5]
[-0.5  -0.5]
[ 0.5   0.5]
[ 1.5   2.5]
</div>
        <div id="plot2" class="plot-container"></div>
    </div>

    <div class="step">
        <h2>Step 4: Calculate Covariance Matrix</h2>
        <p>The covariance matrix C = (1/(n-1)) × X^T × X, where n is the number of data points:</p>
        <div class="calculation">Covariance Matrix calculation:
X^T = [-1.5  -0.5   0.5   1.5]
      [-2.5  -0.5   0.5   2.5]

X^T × X = [-1.5  -0.5   0.5   1.5] × [-1.5  -2.5]
          [-2.5  -0.5   0.5   2.5]   [-0.5  -0.5]
                                      [ 0.5   0.5]
                                      [ 1.5   2.5]

C₁₁ = (-1.5)² + (-0.5)² + (0.5)² + (1.5)² = 2.25 + 0.25 + 0.25 + 2.25 = 5.0
C₁₂ = (-1.5)(-2.5) + (-0.5)(-0.5) + (0.5)(0.5) + (1.5)(2.5) = 3.75 + 0.25 + 0.25 + 3.75 = 8.0
C₂₁ = C₁₂ = 8.0 (covariance matrix is symmetric)
C₂₂ = (-2.5)² + (-0.5)² + (0.5)² + (2.5)² = 6.25 + 0.25 + 0.25 + 6.25 = 13.0

Covariance Matrix C = (1/3) × [5.0   8.0 ] = [1.667  2.667]
                              [8.0  13.0]   [2.667  4.333]
</div>
    </div>

    <div class="step">
        <h2>Step 5: Find Eigenvalues and Eigenvectors</h2>
        <div class="calculation">For matrix C = [1.667  2.667]
                      [2.667  4.333]

Characteristic equation: det(C - λI) = 0
|1.667-λ  2.667  | = 0
|2.667   4.333-λ |

(1.667-λ)(4.333-λ) - (2.667)² = 0
λ² - 6λ + 1.667×4.333 - 7.111 = 0
λ² - 6λ + 0.111 = 0

Using quadratic formula:
λ₁ = (6 + √(36 - 0.444))/2 = (6 + √35.556)/2 ≈ 5.981
λ₂ = (6 - √35.556)/2 ≈ 0.019

Eigenvector for λ₁ ≈ 5.981:
[1.667-5.981  2.667  ][v₁] = [0]  →  [-4.314  2.667][v₁] = [0]
[2.667       4.333-5.981][v₂]   [0]     [2.667  -1.648][v₂]   [0]

From first equation: -4.314v₁ + 2.667v₂ = 0  →  v₂ = 1.618v₁
Normalized: e₁ = [0.528, 0.849]

Eigenvector for λ₂ ≈ 0.019:
e₂ = [0.849, -0.528] (perpendicular to e₁)

Principal Components (sorted by eigenvalue):
PC1: [0.528, 0.849] (explains most variance)
PC2: [0.849, -0.528] (explains remaining variance)
</div>
        <div id="plot3" class="plot-container"></div>
    </div>

    <div class="step">
        <h2>Step 6: Transform Data to PC Space</h2>
        <p>Project the centered data onto the principal components:</p>
        <div class="calculation">Projection Matrix P = [0.528   0.849]  (PC1 as first row)
                              [0.849  -0.528]  (PC2 as second row)

Transformed data Y = X_centered × P^T

For each point:
Point 1: [-1.5, -2.5] × [0.528  0.849] = [-1.5×0.528 + -2.5×0.849, -1.5×0.849 + -2.5×(-0.528)]
                        [0.849 -0.528]   = [-2.915, 0.047]

Point 2: [-0.5, -0.5] → [-0.689, 0.160]
Point 3: [ 0.5,  0.5] → [ 0.689, -0.160]
Point 4: [ 1.5,  2.5] → [ 2.915, -0.047]

Transformed Points in PC space:
[-2.915,  0.047]
[-0.689,  0.160]
[ 0.689, -0.160]
[ 2.915, -0.047]
</div>
        <div id="plot4" class="plot-container"></div>
    </div>

    <div class="step">
        <h2>Step 7: Variance Explained</h2>
        <div class="calculation">Total variance = λ₁ + λ₂ = 5.981 + 0.019 = 6.000

Variance explained by PC1 = λ₁/total = 5.981/6.000 = 99.68%
Variance explained by PC2 = λ₂/total = 0.019/6.000 = 0.32%

PC1 captures almost all the variance in the data!
This makes sense because our original points lie almost on a straight line.
</div>
        <div id="plot5" class="plot-container"></div>
    </div>

    <script>
        // Original data
        const originalData = [[2.0, 2.0], [3.0, 4.0], [4.0, 5.0], [5.0, 7.0]];
        const mean = [3.5, 4.5];
        
        // Centered data
        const centeredData = originalData.map(point => [point[0] - mean[0], point[1] - mean[1]]);
        
        // Principal components (eigenvectors)
        const pc1 = [0.528, 0.849];
        const pc2 = [0.849, -0.528];
        
        // Transformed data
        const transformedData = [
            [-2.915, 0.047],
            [-0.689, 0.160],
            [0.689, -0.160],
            [2.915, -0.047]
        ];

        // Plot 1: Original data
        Plotly.newPlot('plot1', [{
            x: originalData.map(p => p[0]),
            y: originalData.map(p => p[1]),
            mode: 'markers+text',
            type: 'scatter',
            marker: { size: 12, color: 'blue' },
            text: ['P1(2,2)', 'P2(3,4)', 'P3(4,5)', 'P4(5,7)'],
            textposition: 'top center',
            name: 'Original Data'
        }, {
            x: [mean[0]],
            y: [mean[1]],
            mode: 'markers',
            type: 'scatter',
            marker: { size: 15, color: 'red', symbol: 'x' },
            name: 'Mean (3.5, 4.5)'
        }], {
            title: 'Step 1: Original Data Points',
            xaxis: { title: 'X₁', range: [1, 6] },
            yaxis: { title: 'X₂', range: [1, 8] },
            showlegend: true
        });

        // Plot 2: Centered data
        Plotly.newPlot('plot2', [{
            x: originalData.map(p => p[0]),
            y: originalData.map(p => p[1]),
            mode: 'markers',
            type: 'scatter',
            marker: { size: 10, color: 'lightblue', opacity: 0.6 },
            name: 'Original Data'
        }, {
            x: centeredData.map(p => p[0]),
            y: centeredData.map(p => p[1]),
            mode: 'markers+text',
            type: 'scatter',
            marker: { size: 12, color: 'red' },
            text: ['P1(-1.5,-2.5)', 'P2(-0.5,-0.5)', 'P3(0.5,0.5)', 'P4(1.5,2.5)'],
            textposition: 'top center',
            name: 'Centered Data'
        }, {
            x: [0],
            y: [0],
            mode: 'markers',
            type: 'scatter',
            marker: { size: 15, color: 'black', symbol: 'cross' },
            name: 'Origin'
        }], {
            title: 'Step 3: Centered Data (Mean Subtracted)',
            xaxis: { title: 'X₁ - μ₁', range: [-3, 3], zeroline: true },
            yaxis: { title: 'X₂ - μ₂', range: [-3, 3], zeroline: true },
            showlegend: true
        });

        // Plot 3: Principal components
        Plotly.newPlot('plot3', [{
            x: centeredData.map(p => p[0]),
            y: centeredData.map(p => p[1]),
            mode: 'markers',
            type: 'scatter',
            marker: { size: 12, color: 'red' },
            name: 'Centered Data'
        }, {
            x: [-3*pc1[0], 3*pc1[0]],
            y: [-3*pc1[1], 3*pc1[1]],
            mode: 'lines',
            type: 'scatter',
            line: { width: 4, color: 'green', dash: 'dash' },
            name: 'PC1 direction (extended)'
        }, {
            x: [-2*pc2[0], 2*pc2[0]],
            y: [-2*pc2[1], 2*pc2[1]],
            mode: 'lines',
            type: 'scatter',
            line: { width: 4, color: 'orange', dash: 'dash' },
            name: 'PC2 direction (extended)'
        }, {
            x: [0, pc1[0]],
            y: [0, pc1[1]],
            mode: 'lines+markers',
            type: 'scatter',
            line: { width: 6, color: 'darkgreen' },
            marker: { size: 10, color: 'darkgreen', symbol: 'triangle-right' },
            name: 'PC1 vector [0.528, 0.849]'
        }, {
            x: [0, pc2[0]],
            y: [0, pc2[1]],
            mode: 'lines+markers',
            type: 'scatter',
            line: { width: 6, color: 'darkorange' },
            marker: { size: 10, color: 'darkorange', symbol: 'triangle-right' },
            name: 'PC2 vector [0.849, -0.528]'
        }], {
            title: 'Step 5: Principal Components (Eigenvectors) and Projection Matrix Vectors',
            xaxis: { title: 'X₁ - μ₁', range: [-3, 3], zeroline: true },
            yaxis: { title: 'X₂ - μ₂', range: [-3, 3], zeroline: true },
            showlegend: true
        });

        // Plot 4: Transformed data
        Plotly.newPlot('plot4', [{
            x: transformedData.map(p => p[0]),
            y: transformedData.map(p => p[1]),
            mode: 'markers+text',
            type: 'scatter',
            marker: { size: 12, color: 'purple' },
            text: ['P1', 'P2', 'P3', 'P4'],
            textposition: 'top center',
            name: 'Transformed Data'
        }], {
            title: 'Step 6: Data Transformed to PC Space',
            xaxis: { title: 'PC1 (First Principal Component)', range: [-4, 4], zeroline: true },
            yaxis: { title: 'PC2 (Second Principal Component)', range: [-0.5, 0.5], zeroline: true },
            showlegend: true
        });

        // Plot 5: Variance explained
        Plotly.newPlot('plot5', [{
            labels: ['PC1', 'PC2'],
            values: [99.68, 0.32],
            type: 'pie',
            textinfo: 'label+percent',
            textposition: 'outside',
            marker: {
                colors: ['#ff9999', '#66b3ff']
            }
        }], {
            title: 'Step 7: Variance Explained by Each Principal Component'
        });
    </script>
</body>
</html>