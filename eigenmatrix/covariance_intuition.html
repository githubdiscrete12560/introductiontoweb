<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Covariance Matrix Intuition</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .concept-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .example-box {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #9c27b0;
        }
        .warning-box {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        canvas {
            border: 1px solid #ddd;
            margin: 10px;
            background: white;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .matrix-display {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-size: 14px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .section {
            border-left: 4px solid #28a745;
            padding-left: 20px;
            margin: 25px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ The Intuition Behind Covariance Matrix</h1>
        
        <div class="concept-box">
            <h3>üí° Core Idea</h3>
            <p>The covariance matrix tells us <strong>"How do different parts of our data move together?"</strong></p>
            <p>In faces: <strong>"When pixel A is bright, is pixel B usually bright too? Or dark? Or unrelated?"</strong></p>
        </div>

        <div class="section">
            <h2>1Ô∏è‚É£ Start Simple: Two Variables</h2>
            <p>Let's understand covariance with just two measurements:</p>
            
            <div class="grid-container">
                <div>
                    <h4>Interactive 2D Example</h4>
                    <canvas id="scatter2d" width="350" height="300"></canvas>
                    <div>
                        <button onclick="generateData('positive')">Positive Correlation</button>
                        <button onclick="generateData('negative')">Negative Correlation</button>
                        <button onclick="generateData('none')">No Correlation</button>
                    </div>
                </div>
                
                <div>
                    <h4>Covariance Calculation</h4>
                    <div id="covCalc2d" class="matrix-display">
                        Cov(X,Y) = E[(X-Œº‚Çì)(Y-Œº·µß)]<br><br>
                        Click buttons to see examples!
                    </div>
                </div>
            </div>
            
            <div class="concept-box">
                <strong>Interpretation:</strong>
                <ul>
                    <li><strong>Positive covariance:</strong> When X is above average, Y tends to be above average too</li>
                    <li><strong>Negative covariance:</strong> When X is high, Y tends to be low</li>
                    <li><strong>Zero covariance:</strong> X and Y are unrelated</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>2Ô∏è‚É£ Multiple Variables: The Covariance Matrix</h2>
            
            <div class="example-box">
                <h4>üéØ Face Example: 4√ó4 = 16 pixels</h4>
                <p>Each face has 16 pixel values. The covariance matrix is 16√ó16 and contains:</p>
                <ul>
                    <li><strong>Diagonal elements:</strong> How much each pixel varies by itself</li>
                    <li><strong>Off-diagonal elements:</strong> How pairs of pixels vary together</li>
                </ul>
            </div>
            
            <div class="grid-container">
                <div>
                    <h4>Sample Face Data (3 faces)</h4>
                    <canvas id="minifaces" width="300" height="100"></canvas>
                    <button onclick="generateMiniExample()">Generate New Faces</button>
                </div>
                
                <div>
                    <h4>4√ó4 Covariance Matrix</h4>
                    <div id="miniCovMatrix" class="matrix-display">
                        Click "Generate New Faces" to see covariance calculation
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>3Ô∏è‚É£ Geometric Interpretation</h2>
            
            <div class="concept-box">
                <h3>üé™ The Data Cloud</h3>
                <p>Imagine each face as a point in 16-dimensional space. The covariance matrix describes the "shape" of the cloud of points:</p>
            </div>
            
            <div class="grid-container">
                <div>
                    <h4>2D Projection of Data Cloud</h4>
                    <canvas id="dataCloud" width="350" height="300"></canvas>
                    <button onclick="rotateEllipse()">Rotate Correlation</button>
                </div>
                
                <div>
                    <div class="concept-box">
                        <h4>What the ellipse tells us:</h4>
                        <ul>
                            <li><strong>Width/Height:</strong> How spread out the data is</li>
                            <li><strong>Tilt:</strong> How the variables correlate</li>
                            <li><strong>Shape:</strong> Which directions have most variation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>4Ô∏è‚É£ Why Eigenvalues/Eigenvectors?</h2>
            
            <div class="warning-box">
                <h3>üéØ The Key Insight</h3>
                <p>The covariance matrix contains ALL the information about how pixels relate, but it's messy. Eigendecomposition finds the <strong>natural coordinate system</strong> where relationships are simplest!</p>
            </div>
            
            <div class="grid-container">
                <div>
                    <h4>Original Coordinates</h4>
                    <canvas id="originalCoords" width="300" height="250"></canvas>
                </div>
                
                <div>
                    <h4>Eigenvector Coordinates</h4>
                    <canvas id="eigenCoords" width="300" height="250"></canvas>
                </div>
            </div>
            
            <div class="concept-box">
                <strong>Eigendecomposition Magic:</strong>
                <ul>
                    <li><strong>Eigenvectors:</strong> The natural "axes" of the data</li>
                    <li><strong>Eigenvalues:</strong> How much variation along each axis</li>
                    <li><strong>Result:</strong> Instead of 16√ó16 messy relationships, we get a few clean directions!</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>5Ô∏è‚É£ Back to Eigenfaces</h2>
            
            <div class="example-box">
                <h3>üß† In Our 4√ó4 Face Example:</h3>
                <ul>
                    <li><strong>Covariance Matrix (16√ó16):</strong> "How does pixel i relate to pixel j for all i,j?"</li>
                    <li><strong>Eigenfaces:</strong> "What are the main ways faces differ from the average?"</li>
                    <li><strong>Eigenvalues:</strong> "How important is each type of variation?"</li>
                </ul>
            </div>
            
            <div class="matrix-display">
                <strong>Mathematical Flow:</strong><br>
                1. Faces ‚Üí Centered Data Matrix (5√ó16)<br>
                2. Covariance = (1/5) √ó Data^T √ó Data ‚Üí (16√ó16 matrix)<br>
                3. Eigendecomposition: C = V Œõ V^T<br>
                4. Result: V contains eigenfaces, Œõ contains importance weights
            </div>
        </div>

        <div class="concept-box">
            <h3>üöÄ The Big Picture</h3>
            <p>The covariance matrix is like a "relationship map" showing how every part of your data connects to every other part. Eigendecomposition finds the most important patterns in these relationships, letting us ignore the noise and focus on what matters most!</p>
        </div>
    </div>

    <script>
        let currentData = [];
        let faces2x2 = [];

        function generateData(type) {
            currentData = [];
            const n = 50;
            
            for (let i = 0; i < n; i++) {
                let x, y;
                
                if (type === 'positive') {
                    x = Math.random() * 8 - 4;
                    y = x + Math.random() * 2 - 1;
                } else if (type === 'negative') {
                    x = Math.random() * 8 - 4;
                    y = -x + Math.random() * 2 - 1;
                } else { // none
                    x = Math.random() * 8 - 4;
                    y = Math.random() * 8 - 4;
                }
                
                currentData.push([x, y]);
            }
            
            plotScatter2D();
            calculateCovariance2D();
        }

        function plotScatter2D() {
            const canvas = document.getElementById('scatter2d');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, 0);
            ctx.lineTo(canvas.width/2, canvas.height);
            ctx.moveTo(0, canvas.height/2);
            ctx.lineTo(canvas.width, canvas.height/2);
            ctx.stroke();
            
            // Plot points
            ctx.fillStyle = '#2196f3';
            currentData.forEach(([x, y]) => {
                const px = canvas.width/2 + x * 30;
                const py = canvas.height/2 - y * 30;
                ctx.beginPath();
                ctx.arc(px, py, 3, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function calculateCovariance2D() {
            if (currentData.length === 0) return;
            
            // Calculate means
            const meanX = currentData.reduce((sum, [x, y]) => sum + x, 0) / currentData.length;
            const meanY = currentData.reduce((sum, [x, y]) => sum + y, 0) / currentData.length;
            
            // Calculate covariance
            let cov = 0;
            for (let [x, y] of currentData) {
                cov += (x - meanX) * (y - meanY);
            }
            cov /= currentData.length - 1;
            
            // Calculate variances
            let varX = 0, varY = 0;
            for (let [x, y] of currentData) {
                varX += (x - meanX) ** 2;
                varY += (y - meanY) ** 2;
            }
            varX /= currentData.length - 1;
            varY /= currentData.length - 1;
            
            document.getElementById('covCalc2d').innerHTML = `
                <strong>Results:</strong><br>
                Mean X = ${meanX.toFixed(2)}<br>
                Mean Y = ${meanY.toFixed(2)}<br><br>
                
                <strong>Covariance Matrix:</strong><br>
                [${varX.toFixed(2)}   ${cov.toFixed(2)}]<br>
                [${cov.toFixed(2)}   ${varY.toFixed(2)}]<br><br>
                
                <strong>Interpretation:</strong><br>
                Cov(X,Y) = ${cov.toFixed(3)}<br>
                ${cov > 0.5 ? 'üìà Strong positive correlation' : 
                  cov < -0.5 ? 'üìâ Strong negative correlation' : 
                  '‚û°Ô∏è Weak/no correlation'}
            `;
        }

        function generateMiniExample() {
            faces2x2 = [];
            
            // Generate 3 simple 2x2 "faces"
            for (let i = 0; i < 3; i++) {
                let face = [];
                for (let j = 0; j < 4; j++) {
                    // Add some structure plus noise
                    let baseValue = 0.5;
                    if (j === 0 || j === 1) baseValue = 0.7; // "eyes"
                    if (j === 3) baseValue = 0.4; // "mouth"
                    
                    face.push(baseValue + (Math.random() - 0.5) * 0.3);
                }
                faces2x2.push(face);
            }
            
            drawMiniFaces();
            calculateMiniCovariance();
        }

        function drawMiniFaces() {
            const canvas = document.getElementById('minifaces');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            faces2x2.forEach((face, faceIdx) => {
                for (let i = 0; i < 4; i++) {
                    const row = Math.floor(i / 2);
                    const col = i % 2;
                    
                    const x = faceIdx * 80 + col * 30 + 20;
                    const y = row * 30 + 20;
                    
                    const grayValue = Math.floor(face[i] * 255);
                    ctx.fillStyle = `rgb(${grayValue}, ${grayValue}, ${grayValue})`;
                    ctx.fillRect(x, y, 25, 25);
                    
                    // Label pixel
                    ctx.fillStyle = 'red';
                    ctx.font = '10px Arial';
                    ctx.fillText(`${i+1}`, x+2, y+12);
                }
                
                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.fillText(`Face ${faceIdx + 1}`, faceIdx * 80 + 15, 85);
            });
        }

        function calculateMiniCovariance() {
            if (faces2x2.length === 0) return;
            
            // Calculate means for each pixel
            const means = new Array(4).fill(0);
            for (let pixel = 0; pixel < 4; pixel++) {
                for (let face = 0; face < faces2x2.length; face++) {
                    means[pixel] += faces2x2[face][pixel];
                }
                means[pixel] /= faces2x2.length;
            }
            
            // Calculate covariance matrix
            const cov = Array(4).fill().map(() => Array(4).fill(0));
            
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    for (let face = 0; face < faces2x2.length; face++) {
                        cov[i][j] += (faces2x2[face][i] - means[i]) * 
                                     (faces2x2[face][j] - means[j]);
                    }
                    cov[i][j] /= (faces2x2.length - 1);
                }
            }
            
            let matrixStr = 'Pixel:  1      2      3      4<br>';
            for (let i = 0; i < 4; i++) {
                matrixStr += `${i+1}: `;
                for (let j = 0; j < 4; j++) {
                    matrixStr += `${cov[i][j].toFixed(3)} `;
                }
                matrixStr += '<br>';
            }
            
            document.getElementById('miniCovMatrix').innerHTML = `
                <strong>Covariance Matrix (4√ó4):</strong><br>
                ${matrixStr}<br>
                <strong>Key insights:</strong><br>
                ‚Ä¢ Diagonal: variance of each pixel<br>
                ‚Ä¢ Off-diagonal: how pixel pairs co-vary<br>
                ‚Ä¢ Larger values = stronger relationships
            `;
        }

        function plotDataCloud() {
            const canvas = document.getElementById('dataCloud');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, 0);
            ctx.lineTo(canvas.width/2, canvas.height);
            ctx.moveTo(0, canvas.height/2);
            ctx.lineTo(canvas.width, canvas.height/2);
            ctx.stroke();
            
            // Draw ellipse representing data distribution
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 100, 60, Math.PI/4, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw eigenvector directions
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 3;
            ctx.beginPath();
            // First eigenvector
            ctx.moveTo(centerX - 70, centerY - 70);
            ctx.lineTo(centerX + 70, centerY + 70);
            // Second eigenvector
            ctx.moveTo(centerX - 40, centerY + 40);
            ctx.lineTo(centerX + 40, centerY - 40);
            ctx.stroke();
            
            ctx.fillStyle = '#f44336';
            ctx.font = '12px Arial';
            ctx.fillText('Eigenvector 1 (large Œª)', centerX + 50, centerY + 90);
            ctx.fillText('Eigenvector 2 (small Œª)', centerX - 120, centerY - 50);
        }

        function rotateEllipse() {
            plotDataCloud();
        }

        function plotOriginalCoords() {
            const canvas = document.getElementById('originalCoords');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Standard x,y axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, 0);
            ctx.lineTo(canvas.width/2, canvas.height);
            ctx.moveTo(0, canvas.height/2);
            ctx.lineTo(canvas.width, canvas.height/2);
            ctx.stroke();
            
            // Tilted data ellipse
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 80, 40, Math.PI/6, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = 'black';
            ctx.font = '12px Arial';
            ctx.fillText('X', canvas.width - 20, canvas.height/2 - 10);
            ctx.fillText('Y', canvas.width/2 + 10, 15);
            ctx.fillText('Messy correlations!', 10, canvas.height - 10);
        }

        function plotEigenCoords() {
            const canvas = document.getElementById('eigenCoords');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Rotated eigenvector axes
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // First eigenvector direction
            const angle = Math.PI/6;
            ctx.moveTo(centerX - 120*Math.cos(angle), centerY + 120*Math.sin(angle));
            ctx.lineTo(centerX + 120*Math.cos(angle), centerY - 120*Math.sin(angle));
            // Second eigenvector direction  
            ctx.moveTo(centerX + 100*Math.sin(angle), centerY + 100*Math.cos(angle));
            ctx.lineTo(centerX - 100*Math.sin(angle), centerY - 100*Math.cos(angle));
            ctx.stroke();
            
            // Aligned ellipse (no correlation in eigen coordinates)
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 80, 40, angle, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.fillStyle = '#f44336';
            ctx.font = '12px Arial';
            ctx.fillText('PC1', centerX + 70, centerY - 50);
            ctx.fillText('PC2', centerX - 70, centerY - 70);
            ctx.fillStyle = 'black';
            ctx.fillText('Clean separation!', 10, canvas.height - 10);
        }

        // Initialize
        generateData('positive');
        generateMiniExample();
        plotDataCloud();
        plotOriginalCoords();
        plotEigenCoords();
    </script>
</body>
</html>